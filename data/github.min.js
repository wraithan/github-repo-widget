// ## Client-side Javascript API wrapper for GitHub
//
// Tries to map one-to-one with the GitHub API V2, but in a Javascripty manner.
(function(a){var b,c,d,e="https://github.com/api/v2/json/",f=function(a,f,g){var h=+(new Date),i=document.createElement("script");while(k.__jsonp_callbacks[h]!==undefined)h+=Math.random();k.__jsonp_callbacks[h]=function(){delete k.__jsonp_callbacks[h],f.apply(g,arguments)};var j="?";a.indexOf("?")>=0&&(j="&"),a+=j+"callback="+encodeURIComponent("gh.__jsonp_callbacks["+h+"]"),b&&c&&(a+="&login="+b+"&token="+c),d&&(a+="&access_token="+d),i.setAttribute("src",e+a),document.getElementsByTagName("head")[0].appendChild(i)},g=function(a,b){var c=document.createElement("form"),d=document.createElement("iframe");document.body.appendChild(d);var f=d.contentDocument!==undefined?d.contentDocument:d.contentWindow.document,g,h;b=b||{},c.setAttribute("method","post"),c.setAttribute("action",e+a);for(g in b)b.hasOwnProperty(g)&&(h=document.createElement("input"),h.type="hidden",h.value=encodeURIComponent(b[g]),c.appendChild(h));d.setAttribute("style","display: none;"),f.body.appendChild(c),c.submit()},h=function(a){if((!b||!c||b!==a)&&!d)throw new TypeError("gh: Must be authenticated to do that.")},i=function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b+=c+"="+a[c]+"&");return b.replace(/&$/,"")},j=function(a,b){return function(){var c=e;e=a,b.apply(this,arguments),e=c}},k=a.gh={};k.__jsonp_callbacks={},k.authenticate=function(a,e,f){return b=a,c=e,d=f,this},k.user=function(a){if(!(this instanceof k.user))return new k.user(a);this.username=a},k.user.prototype.show=function(a,b){return f("user/show/"+this.username,a,b),this},k.user.prototype.update=function(a){h(this.username);var d,e={login:b,token:c};for(d in a)a.hasOwnProperty(d)&&(e["values["+d+"]"]=encodeURIComponent(a[d]));return g("user/show/"+this.username,e),this},k.user.prototype.following=function(a,b){f("user/show/"+this.username+"/following",a,b)},k.user.prototype.followers=function(a,b){f("user/show/"+this.username+"/followers",a,b)},k.user.prototype.follow=function(a){return h.call(this),g("user/follow/"+a),this},k.user.prototype.unfollow=function(a){return h.call(this),g("user/unfollow/"+a),this},k.user.prototype.watching=function(a,b){return f("repos/watched/"+this.username,a,b),this},k.user.prototype.orgs=function(a,b){return f("user/show/"+this.username+"/organizations",a,b),this},k.user.prototype.allOrgRepos=function(a){return h(this.username),f("organizations/repositories",a),this},k.user.prototype.repos=function(a,b,c){return k.repo.forUser(this.username,a,b,c),this},k.user.prototype.allRepos=function(a,b){function f(){a.call(b,{repositories:c})}function g(a){a.repositories.length==0?f():(c=c.concat(a.repositories),e+=1,k.repo.forUser(d,g,b,e))}var c=[],d=this.username,e=1;return k.repo.forUser(d,g,b,e),this},k.user.prototype.forkRepo=function(a,b){return h(this.username),g("repos/fork/"+a+"/"+b),this},k.user.prototype.pushable=function(a,c){h(b),f("repos/pushable",a,c)},k.user.prototype.publicGists=j("http://gist.github.com/api/v1/json/gists/",function(a,b){return f(this.username,a,b),this}),k.user.search=function(a,b,c){return f("user/search/"+a,b,c),this},k.repo=function(a,b){if(!(this instanceof k.repo))return new k.repo(a,b);this.repo=b,this.user=a},k.repo.prototype.show=function(a,b){return f("repos/show/"+this.user+"/"+this.repo,a,b),this},k.repo.prototype.update=function(a){h(this.user);var d,e={login:b,token:c};for(d in a)a.hasOwnProperty(d)&&(e["values["+d+"]"]=encodeURIComponent(a[d]));return g("repos/show/"+this.user+"/"+this.repo,e),this},k.repo.prototype.tags=function(a,b){return f("repos/show/"+this.user+"/"+this.repo+"/tags",a,b),this},k.repo.prototype.branches=function(a,b){return f("repos/show/"+this.user+"/"+this.repo+"/branches",a,b),this},k.repo.prototype.languages=function(a,b){return f("/repos/show/"+this.user+"/"+this.repo+"/languages",a,b),this},k.repo.prototype.network=function(a,b){return f("repos/show/"+this.user+"/"+this.repo+"/network",a,b),this},k.repo.prototype.contributors=function(a,b,c){var d="repos/show/"+this.user+"/"+this.repo+"/contributors";return c&&(d+="/anon"),f(d,a,b),this},k.repo.prototype.collaborators=function(a,b){return f("repos/show/"+this.user+"/"+this.repo+"/collaborators",a,b),this},k.repo.prototype.addCollaborator=function(a){return h(this.user),g("repos/collaborators/"+this.repo+"/add/"+a),this},k.repo.prototype.removeCollaborator=function(a){return h(this.user),g("repos/collaborators/"+this.repo+"/remove/"+a),this},k.repo.prototype.setPrivate=function(){return h(this.user),g("repo/set/private/"+this.repo),this},k.repo.prototype.setPublic=function(){return h(this.user),g("repo/set/public/"+this.repo),this},k.repo.search=function(a,b,c,d){var e="repos/search/"+a.replace(" ","+");return typeof b=="function"&&(b={},c=arguments[1],d=arguments[2]),e+="?"+i(b),f(e,c,d),this},k.repo.forUser=function(a,b,c,d){return d||(d=1),f("repos/show/"+a+"?page="+d,b,c),this},k.repo.create=function(a,c){return h(b),c.name=a,g("repos/create",c),this},k.repo.del=function(a){return h(b),g("repos/delete/"+a),this},k.commit=function(a,b,c){if(!(this instanceof k.commit))return new k.commit(a,b,c);this.user=a,this.repo=b,this.sha=c},k.commit.prototype.show=function(a,b){return f("commits/show/"+this.user+"/"+this.repo+"/"+this.sha,a,b),this},k.commit.forBranch=function(a,b,c,d,e){return f("commits/list/"+a+"/"+b+"/"+c,d,e),this},k.commit.forPath=function(a,b,c,d,e,g){return f("commits/list/"+a+"/"+b+"/"+c+"/"+d,e,g),this},k.issue=function(a,b,c){if(!(this instanceof k.issue))return new k.issue(a,b,c);this.user=a,this.repo=b,this.number=c},k.issue.prototype.openIssues=function(a,b){return f("issues/list/"+this.user+"/"+this.repo+"/open",a,b),this},k.issue.prototype.closedIssues=function(a,b){return f("issues/list/"+this.user+"/"+this.repo+"/closed",a,b),this},k.issue.prototype.show=function(a,b){return f("issues/show/"+this.user+"/"+this.repo+"/"+this.number,a,b),this},k.issue.prototype.comments=function(a,b){return f("issues/comments/"+this.user+"/"+this.repo+"/"+this.number,a,b),this},k.issue.prototype.close=function(){return h(this.user),g("issues/close/"+this.user+"/"+this.repo+"/"+this.number),this},k.issue.prototype.reopen=function(){return h(this.user),g("issues/reopen/"+this.user+"/"+this.repo+"/"+this.number),this},k.issue.prototype.update=function(a,b){return h(this.user),g("issues/edit/"+this.user+"/"+this.repo+"/"+this.number,{title:a,body:b}),this},k.issue.prototype.addLabel=function(a){return g("issues/label/add/"+this.user+"/"+this.repo+"/"+a+"/"+this.number),this},k.issue.prototype.removeLabel=function(a){return g("issues/label/remove/"+this.user+"/"+this.repo+"/"+a+"/"+this.number),this},k.issue.prototype.comment=function(a){return h(b),g("/issues/comment/"+user+"/"+repo+"/"+this.number,{comment:a}),this},k.issue.labels=function(a,b){return f("issues/labels/"+a+"/"+b,callback,context),this},k.issue.open=function(a,c,d){return h(b),g("issues/open/"+b+"/"+a,{title:c,body:d}),this},k.issue.search=function(a,b,c,d,e,g){return f("/issues/search/"+a+"/"+b+"/"+c+"/"+d,e,g),this},k.issue.list=function(a,b,c,d,e){return f("issues/list/"+a+"/"+b+"/"+c,d,e),this},k.gist=function(a){if(!(this instanceof k.gist))return new k.gist(a);this.id=a},k.gist.prototype.show=j("http://gist.github.com/api/v1/json/",function(a,b){return f(this.id,a,cont),this}),k.gist.prototype.file=j("http://gist.github.com/raw/v1/json/",function(a,b,c){return f(this.id+"/"+a,b,cont),this}),k.object=function(a,b){if(!(this instanceof k.object))return new k.object(a,b);this.user=a,this.repo=b},k.object.prototype.tree=function(a,b,c){return f("tree/show/"+this.user+"/"+this.repo+"/"+a,b,c),this},k.object.prototype.blob=function(a,b,c,d){return f("blob/show/"+this.user+"/"+this.repo+"/"+b+"/"+a,c,d),this},k.object.prototype.blobMeta=function(a,b,c,d){return f("blob/show/"+this.user+"/"+this.repo+"/"+b+"/"+a+"?meta=1",c,d),this},k.object.prototype.blobAll=function(a,b,c){return f("blob/all/"+this.user+"/"+this.repo+"/"+a,b,c),this},k.object.prototype.blobFull=function(a,b,c){return f("blob/full/"+this.user+"/"+this.repo+"/"+a,b,c),this},k.network=function(a,b){if(!(this instanceof k.network))return new k.network(a,b);this.user=a,this.repo=b},k.network.prototype.data=j("http://github.com/",function(a,b,c,d,e){return f(this.user+"/"+this.repo+"/network_data_chunk?"+a+"&"+b+"&"+c,d,e),this}),k.network.prototype.meta=j("http://github.com/",function(a,b){return f(this.user+"/"+this.repo+"/network_meta",a,b),this}),k.pulls=function(a,b){if(!(this instanceof k.pulls))return new k.pulls(a,b);this.user=a,this.repo=b},k.pulls.prototype.allPulls=function(a,b){return f("pulls/"+this.user+"/"+this.repo,a,b),this},k.pulls.prototype.forState=function(a,b,c){return f("pulls/"+this.user+"/"+this.repo+"/"+a,b,c),this},k.pulls.prototype.forNumber=function(a,b,c){return f("pulls/"+this.user+"/"+this.repo+"/"+a,b,c),this}})(window);